<!DOCTYPE html>
<html lang="en">
<head>
<title>Map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
body {
    background: black;
    color: #0f0;
    text-align: center;
    font-family: Monaco, ProFont;
}
</style>
<link rel="stylesheet" href="styles.css">
<script language=javascript>
<!--
var map_json = null;
function fill_map_menu(maps_info) {
    var select = document.getElementById("select_map");
    select.options.length = 0
    var first = -1
    for (let i in maps_info) {
        let map = maps_info[i]
        if (-1 == first) {
            first = select.options.length
        }
        select.options[select.options.length] = new Option(map.map_name, map.map_info, false, false)
    }
    select.options.selectedIndex = first
    load_levels(select.options[first].value)
}
function fill_level_menu(level_info) {
    var select = document.getElementById("select_level");
    select.options.length = 0
    var first = -1
    for (let i in level_info.levels) {
        let level = level_info.levels[i]
        if ('separator' in level) {
            option = new Option(level.separator, null, false, false)
            option.disabled = true
            select.options[select.options.length] = option
            continue
        }
        if (-1 == first) {
            first = select.options.length
        }
        select.options[select.options.length] = new Option(level.name, level.base_name, false, false)
    }
    select.options.selectedIndex = first
    load_level(select.options[first].value)
}
function load_json(path, callback) {
    return fetch(path)
    .then(response => {
        if (!response.ok) {
            throw new Error("HTTP error " + response.status);
        }
        return response.json();
    })
    .then(json => {
        callback(json)
    })
    .catch(function () {
        this.dataError = true;
    })
}
function load_path(path, callback) {
    return fetch(path)
    .then(response => {
        if (!response.ok) {
            throw new Error("HTTP error " + response.status);
        }
        return response.body();
    })
    .then(json => {
        callback(json)
    })
    .catch(function () {
        this.dataError = true;
    })
}
function load_maps() {
    load_json('maps.json', fill_map_menu)
}
function load_levels(path) {
    load_json(path, fill_level_menu)
}
function load_level(base_path) {
    var svg_path = base_path+'.svg'
    var json_path = base_path+'.json'
    load_json(json_path, function (value) {map_json = value})
    display_svg(svg_path)
}
function display_svg(svg) {
    map_object = document.getElementById("map_object")
    map_object.data = svg
}
function map_selection(dropdown) {
    var selected_index  = dropdown.selectedIndex
    var value = dropdown.options[selected_index].value
    load_levels(value)
}
function level_selection(dropdown) {
    var selected_index  = dropdown.selectedIndex
    var value = dropdown.options[selected_index].value
    load_level(value)
}
function toggle_checkbox(checkbox) {
    if (checkbox.readOnly) checkbox.checked=checkbox.readOnly=false;
    else if (!checkbox.checked) checkbox.readOnly=checkbox.indeterminate=true;
}
//-->
</script>
</head>
<body onload="load_maps()">
<div style="float:left;text-align:left;width:20%">
<select name="select_map" id="select_map" onchange='map_selection(this);'>
</select>
<br />
<select name="select_level" id="select_level" onchange='level_selection(this);'>
</select>
<br />
<label><input type="checkbox" id="cb1" onclick="toggle_checkbox(this)">checkbox</input></label>
</div>
<div>
<object id="map_object" type="image/svg+xml" data="logo.svg"></object>
</div>
</body>
</html>
